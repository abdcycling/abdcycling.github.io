/*
 * +Gallery Javascript Photo gallery v0.9.4
 * http://plusgallery.net/
 *
 * Copyright 2013, Jeremiah Martin | Twitter: @jeremiahjmartin
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html

 */
jQuery.ajaxSetup({cache:!1}),/*
SLIDEFADE
------------------------------------------------------------------------------------------------------*/
/* Custom plugin for a slide/in out animation with a fade - JJM */
function(a){a.fn.slideFade=function(a,b){for(var c,d=0;d<arguments.length;d++)if("number"==typeof arguments[d])c=arguments[d];else var e=arguments[d];c||(c=500),this.animate({opacity:"toggle",height:"toggle"},c,function(){"function"!=typeof e&&(e=function(){}),e.call(this)})}}(jQuery),function(a){a.fn.plusGallery=function(b){var c=this;if(0===c.length)return!1;var d={/*user defined Defaults*/
imagePath:"images/plusgallery",type:"google",albumTitle:!1,//show the album title in single album mode
albumLimit:16,//Limit amout of albums to load initially.
limit:30,//Limit of photos to load for gallery / more that 60 is dumb, separate them into different albums
apiKey:"",//used with Flickr
exclude:null,include:null,imageData:null,/*don't touch*/
imgArray:[],titleArray:[],t:"",//timer
idx:0,imgCount:0,imgTotal:0,winWidth:1024,//resets
touch:!1,titleText:"",init:function(){var b=a(document);
//check for touch device
"ontouchstart"in document.documentElement&&(window.scrollTo(0,1),d.touch=!0),d.winWidth=a(window).width(),
//reset some shit in case there is another copy that was loaded.
a("#pgzoomview").remove(),
//Unbind everything first? 
b.off("click",".pgalbumlink, #pgthumbhome, .pgthumb, .pgzoomarrow, .pgzoomclose, #pgzoomview, #pgzoomslide, .pgzoomimg"),d.getDataAttr(),d.writeHTML(),null!==d.albumId||"instagram"==d.type||"local"==d.type&&!d.imageData.hasOwnProperty("albums")?
//load single Album
d.loadSingleAlbum():"local"==d.type?d.parseAlbumData(d.imageData):d.loadAlbumData(),
//attach loadGallery to the album links
b.on("click",".pgalbumlink",function(b){b.preventDefault(),a(this).append('<span class="pgloading"></span>');var c=a(this).children("span").html();if("local"==d.type){var e=a(this).attr("data-album-index").replace("http://","").replace("//","").replace("https://","");d.parseData(d.imageData.albums[e],c)}else{var f=this.href;d.loadGallery(f,c)}}),b.on("click","#pgthumbhome",function(b){b.preventDefault(),a("#pgthumbview").slideFade(700),a("#pgalbums").slideFade(700)}),
//attach links load detail image
b.on("click",".pgthumb",function(b){b.preventDefault();var c=a(".pgthumb").index(this);d.loadZoom(c)}),/*zoom events*/
b.on("click",".pgzoomarrow",function(a){a.preventDefault();var b=this.rel;return d.prevNext(b),!1}),b.on("click",".pgzoomclose",function(a){a.preventDefault(),d.unloadZoom()}),b.on("click","#pgzoomview",function(a){a.preventDefault(),d.unloadZoom()}),b.on("click","#pgzoomslide",function(){d.unloadZoom()}),b.on("click",".pgzoomimg",function(){return a(this).attr("id").replace("pgzoomimg","")<d.imgTotal-1&&d.prevNext("next"),!1}),clearTimeout(d.t)},/*--------------------------
      
        get all the user defined
        variables from the HTML element
      
      ----------------------------*/
getDataAttr:function(){
//Gallery Type *required
var a=c.attr("data-type");if(!a)return alert("You must enter a data type."),!1;if(d.type=a,
//Gallery User Id *required if not local
a=c.attr("data-userid"))d.userId=a;else if("local"!=d.type)return alert("You must enter a valid User ID"),!1;
//Limit on the amount photos per gallery
a=c.attr("data-limit"),a&&(d.limit=a),
//Limit on the amount albums
a=c.attr("data-album-limit"),a&&(d.albumLimit=a),
//album id to exclude
a=c.attr("data-exclude"),a&&(d.exclude=a.split(",")),
//album ids to include
a=c.attr("data-include"),a&&(d.include=a.split(",")),
//Api key - used with Flickr
a=c.attr("data-api-key"),a&&(d.apiKey=a),
//Access Token - used with instagram
a=c.attr("data-access-token"),a&&(d.accessToken=a),a=c.attr("data-album-id"),a?(d.albumId=a,
//show hide the album title if we are in single gallery mode
titleAttr=c.attr("data-album-title"),"true"==titleAttr?d.albumTitle=!0:d.albumTitle=!1):(d.albumTitle=!0,d.albumId=null),a=c.attr("data-credit"),"false"==a?d.credit=!1:d.credit=!0,
//Image path
a=c.attr("data-image-path"),a&&(d.imagePath=a),
//JSON string containing image data *required only for local
a=c.attr("data-image-data"),a&&(d.imageData=JSON.parse(a))},/*--------------------------
      
        set up the initial HTML
      
      ----------------------------*/
writeHTML:function(){var b;d.touch?(b="touch",c.addClass("touch")):(b="no-touch",c.addClass("no-touch")),c.append('<ul id="pgalbums" class="clearfix"></ul><div id="pgthumbview"><ul id="pgthumbs" class="clearfix"></ul></div>'),a("body").prepend('<div id="pgzoomview" class="pg '+b+'"><a href="#" rel="previous" id="pgzoomclose" title="Close">Close</a><a href="#" rel="previous" id="pgprevious" class="pgzoomarrow" title="previous">Previous</a><a href="#" rel="next" id="pgnext" class="pgzoomarrow" title="Next">Next</a><div id="pgzoomscroll"><ul id="pgzoom"></ul></div></div>'),c.addClass("pg"),d.credit===!0&&c.append('<div id="pgcredit"><a href="http://www.plusgallery.net" target="_blank" title="Powered by +GALLERY"><span>+</span>Gallery</a></div>'),
//console.log('pg.albumTitle: ' + pg.albumTitle);
d.albumTitle===!0&&a("#pgthumbview").prepend('<ul id="pgthumbcrumbs" class="clearfix"><li id="pgthumbhome">&laquo;</li></ul>')},/*--------------------------
      
        Parse the album data from
				the given json string.
      
      ----------------------------*/
parseAlbumData:function(b){c.addClass("loaded");var e,f,g,h,i;switch(d.type){
//have to load differently for for google/facebook/flickr
case"google":e=b.feed.entry,f=e.length,f>d.albumLimit&&(f=d.albumLimit),
//remove excluded galleries if there are any.
//albumTotal = albumTotal - pg.exclude.length;
f>0?a.each(e,function(a,b){
//obj is entry
a<f&&(h=b.title.$t,i=b.link[0].href,g=b.media$group.media$thumbnail[0].url,g=g.replace("s160","s210"),d.loadAlbums(h,g,i,a))})://else if albumTotal == 0
alert("There are either no results for albums with this user ID or there was an error loading the data. \n"+i);break;case"flickr":e=b.photosets.photoset,f=e.length,f>d.albumLimit&&(f=d.albumLimit),f>0?a.each(e,function(a,b){
//obj is entry
a<f&&(h=b.title._content,g="http://farm"+b.farm+".staticflickr.com/"+b.server+"/"+b.primary+"_"+b.secret+"_n.jpg",i="http://api.flickr.com/services/rest/?&method=flickr.photosets.getPhotos&api_key="+d.apiKey+"&photoset_id="+b.id+"=&format=json&jsoncallback=?",d.loadAlbums(h,g,i))})://else if albumTotal == 0
alert("There are either no results for albums with this user ID or there was an error loading the data. \n"+i);break;case"facebook":e=b.data,f=e.length,f>d.albumLimit&&(f=d.albumLimit),f>0?a.each(e,function(a,b){a<f&&(h=b.name,i="https://graph.facebook.com/"+b.id+"/photos?limit="+d.limit+"&access_token="+d.accessToken,g="http://graph.facebook.com/"+b.id+"/picture?type=album",d.loadAlbums(h,g,i))}):alert("There are either no results for albums with this user ID or there was an error loading the data. \n"+albumURL);break;case"local":e=b.albums,f=e.length,f>d.albumLimit&&(f=d.albumLimit),f>0?a.each(e,function(a,b){
//obj is entry
a<f&&(h=b.title,g=b.images[0].th,i="http://"+a,d.loadAlbums(h,g,i))})://else if albumTotal == 0
alert("There are no albums available in the specified JSON.")}},/*--------------------------
      
        Load up Album Data JSON
        before Albums
      
      ----------------------------*/
loadAlbumData:function(){var b;switch(d.type){case"google":b="https://picasaweb.google.com/data/feed/base/user/"+d.userId+"?alt=json&kind=album&hl=en_US&max-results="+d.albumLimit+"&callback=?";break;case"flickr":b="http://api.flickr.com/services/rest/?&method=flickr.photosets.getList&api_key="+d.apiKey+"&user_id="+d.userId+"&format=json&jsoncallback=?";break;case"facebook":b="https://graph.facebook.com/"+d.userId+"/albums?limit="+d.albumLimit+"&access_token="+d.accessToken+"&callback=?";break;case"instagram":
//we ain't got no albums in instagram
b=null;break;case"local":
// No album support yet, but url wont be needed anyway.
b=null;break;default:alert("Please define a gallery type.")}a.getJSON(b,function(a){d.parseAlbumData(a)})},/*--------------------------
      
        Load all albums to the page
      
      ----------------------------*/
loadAlbums:function(b,c,e){var f,g=!0;
//exclude albums if pg.exclude is set
null!==d.exclude&&a.each(d.exclude,function(a,b){//exclude albums if pg.exclude is set
e.indexOf(b)>0&&(g=!1)}),
//include only specified albums if pg.include is set
null!==d.include&&(g=!1,a.each(d.include,function(a,b){//exclude albums if pg.exclude is set
e.indexOf(b)>0&&(g=!0)})),g&&(f="facebook"==d.type||"flickr"==d.type?'<img src="'+d.imagePath+'/square.png" style="background-image: url('+c+');" title="'+b+'" title="'+b+'" class="pgalbumimg">':'<img src="'+c+'" title="'+b+'" title="'+b+'" class="pgalbumimg">',"local"==d.type?a("#pgalbums").append('<li class="pgalbumthumb"><a href="#" data-album-index="'+e+'" class="pgalbumlink">'+f+'<span class="pgalbumtitle">'+b+'</span><span class="pgplus">+</span></a></li>'):a("#pgalbums").append('<li class="pgalbumthumb"><a href="'+e+'" class="pgalbumlink">'+f+'<span class="pgalbumtitle">'+b+'</span><span class="pgplus">+</span></a></li>'))},//End loadAlbums
/*--------------------------
      
        Load all the images within
        a specific gallery
      
      ----------------------------*/
loadSingleAlbum:function(){var b;switch(d.type){case"google":b="https://picasaweb.google.com/data/feed/base/user/"+d.userId+"/albumid/"+d.albumId+"?alt=json&hl=en_US",d.loadGallery(b);break;case"flickr":b="http://api.flickr.com/services/rest/?&method=flickr.photosets.getPhotos&api_key="+d.apiKey+"&photoset_id="+d.albumId+"=&format=json&jsoncallback=?",d.loadGallery(b);break;case"facebook":b="https://graph.facebook.com/"+d.albumId+"/photos?limit="+d.limit+"&access_token="+d.accessToken,d.loadGallery(b);break;case"instagram":b="https://api.instagram.com/v1/users/"+d.userId+"/media/recent/?access_token="+d.accessToken+"&count="+d.limit,d.loadGallery(b);break;case"local":d.parseData(d.imageData)}c.addClass("loaded"),a("#pgthumbhome").hide()},/*--------------------------
      
        Load all the images within
        a specific gallery
      
      ----------------------------*/
loadGallery:function(b,c){d.imgArray=[],d.titleArray=[],a("#pgzoom").empty(),a.ajax({url:b,cache:!1,dataType:"jsonp",success:function(a){d.parseData(a,c)},//end success
error:function(a,b,c){console.log("Error: \njqXHR:"+a+"\ntextStatus: "+b+"\nerrorThrown: "+c)}})},//End loadGallery
/*--------------------------
      
        Parse and convert the data
        of the gallery
      
      ----------------------------*/
parseData:function(b,c){var e,f,g,h,i,j="",k=0;switch(a(".crumbtitle").remove(),a("#pgthumbs").empty(),void 0===c&&(c="&nbsp;"),a("#pgthumbcrumbs").append('<li class="crumbtitle">'+c+"</li>"),d.type){case"google":objPath=b.feed.entry;break;case"flickr":objPath=b.photoset.photo;break;case"facebook":objPath=b.data;break;case"instagram":objPath=b.data;break;case"local":objPath=b.images}d.imgTotal=objPath.length,
//limit the results
d.limit<d.imgTotal&&(d.imgTotal=d.limit),0===d.imgTotal&&alert("Please check your photo permissions,\nor make sure there are photos in this gallery."),d.winWidth>1100?(h=1024,i="_b"):d.winWidth>620?(h=768,i="_b"):(h=540,i="_z"),a.each(objPath,function(b,c){
//limit the results
if(b<d.limit){switch(d.type){case"google":e=c.title.$t,f=c.media$group.media$content[0].url;var l=f.lastIndexOf("/"),m=f.substring(l);
//show the max width image 1024 in this case
f=f.replace(m,"/s"+h+m),g=c.media$group.media$thumbnail[1].url,g=g.replace("s144","s160-c");break;case"flickr":e=c.title,f="http://farm"+c.farm+".staticflickr.com/"+c.server+"/"+c.id+"_"+c.secret+i+".jpg",g="http://farm"+c.farm+".staticflickr.com/"+c.server+"/"+c.id+"_"+c.secret+"_q.jpg";break;case"facebook":e=c.name,f=c.images[1].source,g=d.imagePath+"/square.png",j=' style="background: url('+c.images[3].source+') no-repeat 50% 50%; background-size: cover;"';break;case"instagram":null!==c.caption&&(e=c.caption.text),f=c.images.standard_resolution.url,g=c.images.low_resolution.url;break;case"local":null!==c.caption&&(e=c.caption),f=c.src,g=c.th}e||(e=""),d.imgArray[b]=f,d.titleArray[b]=e,a("#pgthumbs").append('<li class="pgthumb"><a href="'+f+'"><img src="'+g+'" id="pgthumbimg'+b+'" class="pgthumbimg" alt="'+e+'" title="'+e+'"'+j+"></a></li>"),
//check to make sure all the images are loaded and if so show the thumbs
a("#pgthumbimg"+b).load(function(){k++,k==d.imgTotal&&(a("#pgalbums").slideFade(700,function(){a(".pgalbumthumb .pgloading").remove()}),a("#pgthumbview").slideFade(700))})}})},zoomIdx:null,//the zoom index
zoomImagesLoaded:[],zoomScrollDir:null,zoomScrollLeft:0,loadZoom:function(b){d.zoomIdx=b,d.winWidth=a(window).width();var c=a("#pgzoomview"),e=(a("#pgzoomscroll"),a("#pgprevious")),f=a("#pgnext"),g=(a("#pgzoom"),""),h=d.imgArray.length;c.addClass("fixed"),
//show/hide the prev/next links
0===b&&e.hide(),b==h-1&&f.hide();var i=d.imgArray.length*d.winWidth;a("#pgzoom").width(i);var j=parseInt(b*d.winWidth);c.fadeIn(function(){
//this has gotta come in after the fade or iOS blows up.
a(window).on("resize",d.resizeZoom),a.each(d.imgArray,function(c){g=g+'<li class="pgzoomslide loading" id="pgzoomslide'+c+'" style="width: '+d.winWidth+'px;"><img src="'+d.imagePath+'/square.gif" class="pgzoomspacer"><span class="pgzoomcaption">'+d.titleArray[c]+"</span></li>",c+1==d.imgArray.length&&(
//at the end of the loop
a("#pgzoom").html(g),d.zoomKeyPress(),a("#pgzoomscroll").scrollLeft(j),d.zoomScrollLeft=j,d.loadZoomImg(b),d.zoomScroll(),
//load siblings
b-1>=0&&d.loadZoomImg(b-1),b+1<d.imgArray.length&&d.loadZoomImg(b+1))})})},loadZoomImg:function(b){0===a("#pgzoomimg"+b).length&&(a("#pgzoomslide"+b+" .pgzoomspacer").after('<img src="'+d.imgArray[b]+'" data-src="'+d.imgArray[b]+'" title="'+d.titleArray[b]+'" alt="'+d.titleArray[b]+'" id="pgzoomimg'+b+'" class="pgzoomimg">'),a("#pgzoomimg"+b).load(function(){a(this).addClass("active")}))},zoomScroll:function(){var b,c=a("#pgprevious"),e=a("#pgnext"),f=!0;a("#pgzoomscroll").on("scroll",function(){currentScrollLeft=a(this).scrollLeft(),f===!0&&(f=!1,b=setTimeout(function(){/*Check if we have scrolled left and if so load up the zoom image*/
if(0===currentScrollLeft?c.fadeOut():c.fadeIn(),currentScrollLeft>=(d.imgTotal-1)*d.winWidth?e.fadeOut():e.fadeIn(),currentScrollLeft%d.zoomScrollLeft>20||currentScrollLeft>0&&0===d.zoomScrollLeft){d.zoomScrollLeft=currentScrollLeft;var a=d.zoomScrollLeft/d.winWidth,b=Math.ceil(a),g=Math.floor(a);
//Lazy load siblings on scroll.
d.zoomImagesLoaded[b]||d.loadZoomImg(b),d.zoomImagesLoaded[g]||d.loadZoomImg(g)}f=!0},200))})},zoomKeyPress:function(){a(document).on("keyup","body",function(a){27==a.which?d.unloadZoom():37==a.which?d.prevNext("previous"):39==a.which&&d.prevNext("next")})},resizeZoom:function(){d.winWidth=a(window).width();var b=d.imgArray.length*d.winWidth;a("#pgzoom").width(b),a(".pgzoomslide").width(d.winWidth);var c=parseInt(d.zoomIdx*d.winWidth);a("#pgzoomscroll").scrollLeft(c)},unloadZoom:function(){a(document).off("keyup","body"),a(window).off("resize",d.resizeZoom),a("#pgzoomscroll").off("scroll"),a("#pgzoomview").fadeOut(function(){a("#pgzoom").empty(),a("#pgzoomview").off("keyup"),a("#pgzoomview").removeClass("fixed")})},prevNext:function(b){var c=a("#pgzoomscroll").scrollLeft()/d.winWidth;"previous"==b?d.zoomIdx=Math.round(c)-1:d.zoomIdx=Math.round(c)+1;var e=d.zoomIdx*d.winWidth;a("#pgzoomscroll").stop().animate({scrollLeft:e})}};a.extend(d,b),d.init()}}(jQuery);